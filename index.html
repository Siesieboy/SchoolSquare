<!DOCTYPE html>
<html lang="nl" data-theme="light">
<head>
  <!-- Favicons - Plak dit in de <head> van je HTML -->

  <!-- Standard favicons -->
  <link rel="icon" type="image/png" sizes="16x16" href="https://i.ibb.co/rGn2bZkT/favicon-16x16-png.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://i.ibb.co/BvVfJ4c/favicon-32x32-png.png">
  <link rel="icon" type="image/png" sizes="48x48" href="https://i.ibb.co/6RJ9tkHv/favicon-48x48-png.png">

  <!-- Apple Touch Icon (iOS) -->
  <link rel="apple-touch-icon" sizes="180x180" href="https://i.ibb.co/hRCtXdPm/apple-touch-icon-png.png">

  <!-- Android Chrome -->
  <link rel="icon" type="image/png" sizes="192x192" href="https://i.ibb.co/HLHzWgj3/android-chrome-192x192-png.png">
  <link rel="icon" type="image/png" sizes="512x512" href="https://i.ibb.co/Sw24zdFV/android-chrome-512x512-png.png">

  <!-- Standaard fallback -->
  <link rel="shortcut icon" href="https://i.ibb.co/BvVfJ4c/favicon-32x32-png.png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <title>SchoolSquare</title>

</head>

<body>
<div class="bg-orbit"></div>
<div class="bg-grid"></div>
<div class="app">

<div class="hero">
  <div><h1 id="groet" style="margin:0;">Laden...</h1><p style="margin:5px 0 0 0; opacity:0.8;">Focus modus aan üöÄ</p></div>
  <div class="hero-right">
    <div class="clock-time" id="time">00:00</div>
    <div id="date" style="opacity:0.9;">--</div>
    <button id="themeToggle" class="theme-btn">üåô</button>
  </div>
</div>

<div class="nav">
  <button class="active" onclick="show('dashboard',this)">Dashboard</button>
  <button onclick="show('cijfers',this)">Cijfers</button>
  <button onclick="show('overhoren',this)">Overhoren</button>
</div>

<div id="dashboard" class="section active">
  <div class="stats-grid">
    <div class="stat-card"><h2 id="openCount">0</h2><span>Taken te gaan</span></div>
    <div class="stat-card"><h2 id="dagenCount">0</h2><span>Dagen tot eerstvolgende taak</span></div>
  </div>

  <div class="card" id="toetsForm">
    <h3>Nieuwe taak</h3>
    <input id="naam" type="text" placeholder="Welk vak?" list="vakkenLijst">
    <datalist id="vakkenLijst"></datalist>
    <select id="type" style="width:100%; background:var(--panel); color:var(--text); border:1px solid rgba(18, 27, 42, 0.12); padding:14px 15px; border-radius:14px; margin-bottom:12px; outline:none; font-size:16px;">
      <option value="toets">Toets</option>
      <option value="huiswerk">Huiswerk</option>
      <option value="opdracht">Opdracht</option>
      <option value="persoonlijk">Persoonlijke opdracht</option>
    </select>
    <input id="datum" type="date">
    <textarea id="notitie" placeholder="Wat moet je precies doen?"></textarea>
    <button class="btn-primary" onclick="addToets()">Taak Toevoegen</button>
  </div>
  <div class="filter-bar">
    <button class="filter-btn active" data-type="all" onclick="setFilter('all', this)">Alles</button>
    <button class="filter-btn" data-type="toets" onclick="setFilter('toets', this)">Toetsen</button>
    <button class="filter-btn" data-type="huiswerk" onclick="setFilter('huiswerk', this)">Huiswerk</button>
    <button class="filter-btn" data-type="opdracht" onclick="setFilter('opdracht', this)">Opdrachten</button>
    <button class="filter-btn" data-type="persoonlijk" onclick="setFilter('persoonlijk', this)">Persoonlijk</button>
  </div>
  <div class="grid" id="toetsenLijst"></div>
</div>

<div id="cijfers" class="section">
  <div class="card">
    <h3>Cijfercalculator</h3>
    <label style="font-size:12px; font-weight:700;">HUIDIG GEMIDDELDE</label>
    <input id="huidig" type="text" inputmode="decimal" placeholder="bijv. 6.5">
    <label style="font-size:12px; font-weight:700;">WEGING NIEUWE TOETS</label>
    <input id="weging" type="text" inputmode="decimal" placeholder="bijv. 2">
    <label style="font-size:12px; font-weight:700;">GEWENST GEMIDDELDE</label>
    <input id="doel" type="text" inputmode="decimal" placeholder="bijv. 7.0">
    <button class="btn-primary" onclick="bereken()">Bereken resultaat</button>
    <div id="resultBox" style="display:none; margin-top:20px; padding:20px; border-radius:15px; background:var(--accent-soft); text-align:center;">
        <h4 id="resultaat" style="margin:0;"></h4>
    </div>
  </div>
</div>

<div id="overhoren" class="section">
  <div class="card">
    <h3>Overhoren</h3>
    <textarea id="leerstof" style="height:120px;" placeholder="Plak je tekst hier..."></textarea>
    <div class="button-group">
        <button class="btn-primary" style="flex:2;" onclick="genereerFlashcards(false)">Vragen genereren</button>
        <button class="btn-outline" onclick="genereerFlashcards(true)">+ Extra toevoegen</button>
        <button onclick="resetFlashcards()" style="background:none; border:1px solid var(--error); color:var(--error); border-radius:30px; padding:10px 15px; cursor:pointer; font-weight:700;">Wissen</button>
    </div>
  </div>
  <div class="grid" id="flashcardsLijst"></div>
</div>

</div>

<script>
let toetsen = JSON.parse(localStorage.getItem("schoolsquare_toetsen")) || [];
let vakken = JSON.parse(localStorage.getItem("schoolsquare_vakken")) || [];
let currentFilter = "all";

/* ================= NAVIGATIE ================= */
function show(id, btn) {
  document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
  document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  btn.classList.add("active");
}

/* ================= TOETSEN LOGIC ================= */
function addToets() {
  const n = document.getElementById("naam"), d = document.getElementById("datum"), nt = document.getElementById("notitie");
  const type = document.getElementById("type");
  if (!n.value || !d.value) return n.classList.add("error-glow");
  
  toetsen.push({ id: Date.now(), naam: n.value, datum: d.value, notitie: nt.value, type: type.value });
  localStorage.setItem("schoolsquare_toetsen", JSON.stringify(toetsen));

  if (n.value && !vakken.includes(n.value)) {
    vakken.push(n.value);
    localStorage.setItem("schoolsquare_vakken", JSON.stringify(vakken));
    renderVakken();
  }
  
  n.value = ""; d.value = ""; nt.value = "";
  n.classList.remove("error-glow");
  renderToetsen();
}

function deleteToets(id) {
  toetsen = toetsen.filter(t => t.id !== id);
  localStorage.setItem("schoolsquare_toetsen", JSON.stringify(toetsen));
  renderToetsen();
}

function cleanupExpired() {
  const now = new Date();
  const filtered = toetsen.filter(t => {
    const d = new Date(t.datum);
    d.setHours(23, 59, 59, 999);
    return d >= now;
  });
  if (filtered.length !== toetsen.length) {
    toetsen = filtered;
    localStorage.setItem("schoolsquare_toetsen", JSON.stringify(toetsen));
  }
}

function renderToetsen() {
  cleanupExpired();
  const lijst = document.getElementById("toetsenLijst");
  lijst.innerHTML = "";
  const gefilterd = currentFilter === "all" ? toetsen : toetsen.filter(t => t.type === currentFilter);
  gefilterd.sort((a, b) => new Date(a.datum) - new Date(b.datum));

  const typeMeta = {
    toets: { label: "Toets", emoji: "üìù" },
    huiswerk: { label: "Huiswerk", emoji: "üìö" },
    opdracht: { label: "Opdracht", emoji: "üß©" },
    persoonlijk: { label: "Persoonlijk", emoji: "‚≠ê" }
  };

  gefilterd.forEach(t => {
    const div = document.createElement("div");
    div.className = "toets-card";
    const dStr = new Date(t.datum).toLocaleDateString("nl-NL", { day: 'numeric', month: 'long' });
    const meta = typeMeta[t.type] || { label: "Taak", emoji: "üìå" };
    div.innerHTML = `
      <div class="toets-badge">${meta.emoji} ${meta.label} ¬∑ ${dStr}</div>
      <h4 style="margin:5px 0;">${t.naam}</h4>
      <p style="font-size:14px; color:var(--muted); margin-bottom:15px;">${t.notitie || 'Geen extra info.'}</p>
      <button onclick="deleteToets(${t.id})" style="background:none; border:none; color:var(--error); cursor:pointer; font-weight:700; font-size:11px; padding:0;">üóëÔ∏è VERWIJDEREN</button>
    `;
    lijst.appendChild(div);
  });
  updateStats();
}

function renderVakken() {
  const lijst = document.getElementById("vakkenLijst");
  if (!lijst) return;
  lijst.innerHTML = "";
  [...new Set(vakken)].sort().forEach(v => {
    const opt = document.createElement("option");
    opt.value = v;
    lijst.appendChild(opt);
  });
}

function updateStats() {
  document.getElementById("openCount").textContent = toetsen.length;
  const dCount = document.getElementById("dagenCount");
  if (toetsen.length > 0) {
    const diff = Math.ceil((new Date(toetsen[0].datum) - new Date().setHours(0,0,0,0)) / (1000 * 60 * 60 * 24));
    dCount.textContent = diff < 0 ? 0 : diff;
  } else { dCount.textContent = 0; }
}

function setFilter(type, btn) {
  currentFilter = type;
  document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
  if (btn) btn.classList.add("active");
  renderToetsen();
}

/* ================= FLASHCARDS LOGIC ================= */
function resetFlashcards() {
    document.getElementById("flashcardsLijst").innerHTML = "";
    document.getElementById("leerstof").value = "";
}

function genereerFlashcards(append) {
  const tI = document.getElementById("leerstof"), lijst = document.getElementById("flashcardsLijst");
  if (!append) lijst.innerHTML = "";
  if (tI.value.length < 5) return;

  const zinnen = tI.value.split(/[.!?\n]/).filter(z => z.trim().length > 10);
  zinnen.forEach(z => {
      const container = document.createElement("div");
      container.className = "flashcard-container";
      container.onclick = () => container.classList.toggle("flipped");
      container.innerHTML = `
        <div class="flashcard-inner">
            <div class="flashcard-front">‚ùì ${z.trim()}?</div>
            <div class="flashcard-back">‚úÖ Antwoord:<br><small>Context: "${z.trim()}"</small></div>
        </div>`;
      lijst.appendChild(container);
  });
  tI.value = "";
}

/* ================= CALCULATOR ================= */
function bereken() {
  const h = parseFloat(document.getElementById("huidig").value.replace(',','.'));
  const w = parseFloat(document.getElementById("weging").value.replace(',','.'));
  const d = parseFloat(document.getElementById("doel").value.replace(',','.'));
  if (isNaN(h) || isNaN(w) || isNaN(d)) return;
  const res = (d * (w + 1) - h) / w;
  const box = document.getElementById("resultBox");
  box.style.display = "block";
  document.getElementById("resultaat").innerHTML = `Je moet een <b style="font-size:22px; color:var(--accent);">${res.toFixed(1)}</b> halen!`;
}

/* ================= CORE ================= */
function updateClock(){
  const d=new Date();
  document.getElementById("time").textContent=d.toLocaleTimeString("nl-NL",{hour:"2-digit",minute:"2-digit"});
  document.getElementById("date").textContent=d.toLocaleDateString("nl-NL",{weekday:"long",day:"numeric",month:"long"});
  const h=d.getHours();
  document.getElementById("groet").textContent = h<12?"Goedemorgen":h<18?"Goedemiddag":"Goedenavond";
}
setInterval(updateClock,1000); updateClock();
renderVakken();
renderToetsen();

const themeBtn = document.getElementById("themeToggle");
const savedTheme = localStorage.getItem("theme") || "light";
document.documentElement.dataset.theme = savedTheme;
themeBtn.textContent = savedTheme === "dark" ? "‚òÄÔ∏è" : "üåô";

themeBtn.onclick = () => {
  const h = document.documentElement;
  const n = h.dataset.theme === "dark" ? "light" : "dark";
  h.dataset.theme = n;
  localStorage.setItem("theme", n);
  themeBtn.textContent = n === "dark" ? "‚òÄÔ∏è" : "üåô";
};

renderToetsen();
</script>
</body>
</html>
